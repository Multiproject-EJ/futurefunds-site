<!doctype html>
<html lang="en" data-lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FutureFunds â€” Universe Editor</title>
  <link rel="stylesheet" href="/assets/styles.css" />
  <style>
    .editor-wrap{max-width:960px;margin:32px auto;padding:0 16px}
    .editor-grid{display:grid;gap:18px}
    .editor-grid label{display:block;font-size:.9rem;margin-bottom:4px;color:var(--muted,#64748b)}
    .editor-grid input,.editor-grid textarea, .editor-grid select{
      width:100%;padding:12px 14px;border:1px solid var(--border,#e5e7eb);border-radius:12px;background:var(--panel,#fff);
      color:var(--text,#0f172a);
    }
    .editor-grid textarea{min-height:120px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .field-row{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .muted-small{color:var(--muted,#64748b);font-size:.9rem;margin:4px 0 0}
    .recent-list{margin-top:22px;display:grid;gap:12px}
    .recent-card{border:1px solid var(--border,#e5e7eb);border-radius:12px;padding:16px;background:var(--panel,#fff);}
    .recent-card h3{margin:0 0 6px}
    .recent-card .tags{margin-top:6px}
    .note-box button{margin-left:10px}
    .analysis-source{border:1px solid var(--border,#e5e7eb);border-radius:16px;padding:16px;background:var(--panel,#fff);display:grid;gap:14px}
    .analysis-source__head{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between}
    .analysis-source__modes{display:flex;gap:8px;flex-wrap:wrap}
    .analysis-mode-btn{border:1px solid var(--border,#e5e7eb);background:transparent;color:var(--muted,#64748b);padding:8px 12px;border-radius:999px;font-size:.85rem;cursor:pointer;transition:border-color .15s ease,background .15s ease,color .15s ease}
    .analysis-mode-btn.active{background:var(--accent,#2563eb);color:#fff;border-color:var(--accent,#2563eb)}
    .analysis-mode-btn:not(.active):hover{border-color:var(--accent,#2563eb);color:var(--accent,#2563eb)}
    .analysis-source__panel{display:grid;gap:12px}
    .analysis-source textarea{min-height:200px}
    .analysis-source__actions{display:flex;flex-wrap:wrap;align-items:center;gap:10px}
    .analysis-status[data-tone="error"]{color:var(--danger,#ff6b6b)}
    .analysis-status[data-tone="success"]{color:var(--ok,#31d0a3)}
    .analysis-status[data-tone="info"]{color:var(--muted,#64748b)}
    .analysis-source__panel-note{color:var(--muted,#64748b);font-size:.85rem;margin:0}
    .analysis-ai-grid{display:grid;gap:12px}
    .analysis-ai-grid .field-row{margin:0}
    .analysis-ai-grid textarea{min-height:100px}
    .prompt-selector{position:relative;display:inline-flex;align-items:center;gap:8px;flex-wrap:wrap}
    .prompt-menu{position:absolute;top:calc(100% + 6px);left:0;min-width:260px;padding:8px;border:1px solid var(--border,#e5e7eb);border-radius:12px;background:var(--panel,#fff);box-shadow:0 12px 30px rgba(15,23,42,.12);display:grid;gap:6px;z-index:40}
    .prompt-menu[hidden]{display:none}
    .prompt-menu button{border:none;background:transparent;text-align:left;padding:8px 10px;border-radius:10px;font-size:.9rem;color:var(--text,#0f172a);cursor:pointer;transition:background .15s ease,color .15s ease}
    .prompt-menu button strong{display:block;font-weight:600}
    .prompt-menu button span{display:block;font-size:.8rem;color:var(--muted,#64748b);margin-top:2px}
    .prompt-menu button:hover{background:rgba(37,99,235,.08)}
    .prompt-menu button.active{background:var(--accent,#2563eb);color:#fff}
    .prompt-menu button.active span{color:rgba(255,255,255,.85)}
    .prompt-details{margin-top:8px;border:1px solid var(--border,#e5e7eb);border-radius:12px;padding:12px;background:rgba(148,163,184,.1);font-size:.85rem;color:var(--muted,#64748b)}
    .prompt-preview{margin-top:6px;padding:12px;border:1px solid var(--border,#e5e7eb);border-radius:12px;background:var(--panel,#fff);max-height:220px;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.78rem;line-height:1.4;color:var(--text,#0f172a)}
    .select-edit{display:flex;align-items:center;gap:8px}
    .select-edit select{flex:1 1 auto}
    .model-editor{margin-top:10px;border:1px dashed var(--border,#e5e7eb);border-radius:12px;padding:12px;display:grid;gap:10px;background:rgba(148,163,184,.08)}
    .model-editor textarea{min-height:120px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .model-editor__actions{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:20px;z-index:120}
    .modal[hidden]{display:none}
    .modal__backdrop{position:absolute;inset:0;background:rgba(15,23,42,.55)}
    .modal__dialog{position:relative;background:var(--panel,#fff);color:var(--text,#0f172a);border-radius:18px;max-width:960px;width:100%;max-height:90vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 24px 60px rgba(15,23,42,.28)}
    .modal__header,.modal__footer{padding:18px 24px;border-color:var(--border,#e5e7eb);display:flex;align-items:center}
    .modal__header{justify-content:space-between;border-bottom:1px solid var(--border,#e5e7eb);gap:12px}
    .modal__footer{justify-content:flex-end;gap:12px;border-top:1px solid var(--border,#e5e7eb)}
    .modal__body{display:grid;grid-template-columns:260px 1fr;gap:0;min-height:420px}
    .modal__sidebar{background:var(--panel-muted,#f8fafc);border-right:1px solid var(--border,#e5e7eb);padding:18px;overflow:auto}
    .modal__content{padding:18px;overflow:auto;display:grid;gap:16px}
    .prompt-editor__sidebar-actions{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;gap:10px}
    .prompt-editor__list{display:grid;gap:8px}
    .prompt-editor__list button{width:100%;text-align:left;border:1px solid transparent;border-radius:10px;padding:10px 12px;background:transparent;color:inherit;cursor:pointer;transition:background .15s ease,border-color .15s ease,color .15s ease}
    .prompt-editor__list button strong{display:block;font-weight:600}
    .prompt-editor__list button span{display:block;font-size:.8rem;color:var(--muted,#64748b);margin-top:2px}
    .prompt-editor__list button:hover{border-color:var(--accent,#2563eb)}
    .prompt-editor__list button.active{background:var(--accent,#2563eb);color:#fff;border-color:var(--accent,#2563eb)}
    .prompt-editor__list button.active span{color:rgba(255,255,255,.85)}
    .prompt-editor__list button[data-archived="true"]{opacity:.72}
    .prompt-editor__empty{color:var(--muted,#64748b);font-size:.9rem}
    .prompt-editor__form{display:grid;gap:16px}
    .prompt-editor__form .field-group{display:grid;gap:6px}
    .prompt-editor__form label{font-weight:600;font-size:.9rem}
    .prompt-editor__form input,.prompt-editor__form textarea{padding:10px 12px;border:1px solid var(--border,#e5e7eb);border-radius:10px;background:var(--panel,#fff);color:var(--text,#0f172a)}
    .prompt-editor__form textarea{min-height:220px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .prompt-editor__row{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    .prompt-editor__toggles{display:flex;gap:18px;flex-wrap:wrap;align-items:center}
    .prompt-editor__toggle{display:flex;gap:8px;align-items:center;font-size:.9rem;color:var(--muted,#64748b)}
    .prompt-editor__toggle input{margin:0}
    .prompt-editor__status{min-height:18px}
  </style>
</head>
<body>
  <header class="site-header">
    <a class="brand" href="/">
      <img src="/images/logo.webp" alt="FutureFunds.ai logo" class="logo" />
      <span>FutureFunds.ai</span>
    </a>
    <button class="nav-toggle" id="navToggle" type="button" aria-expanded="false" aria-controls="siteNav">
      <span class="sr-only">Menu</span>
      <span class="nav-toggle__bar"></span>
    </button>
    <nav class="nav" id="siteNav" aria-label="Primary navigation">
      <a href="/strategy.html" data-i18n="nav.strategy">Strategy</a>
      <a href="/tools.html" data-i18n="nav.investmentTools">Investment Tools</a>
      <a href="/ai-economy.html" data-i18n="nav.aiEconomy">The AI Economy</a>
      <a href="/portfolio.html" data-i18n="nav.portfolios">Portfolios</a>
      <a href="/universe.html" data-i18n="nav.universe">Universe</a>
      <button id="langBtn" class="btn small">EN â–¾</button>
      <button id="themeToggle" class="btn small ghost theme-toggle" aria-label="Toggle theme">
        <span class="theme-toggle__icon" aria-hidden="true">ðŸŒ—</span>
        <span class="theme-toggle__label" data-i18n="nav.themeToggle">Theme</span>
      </button>
      <a id="patreonLogin" class="btn danger" href="/membership.html" data-i18n="cta.membership">Membership</a>
    </nav>
  </header>

  <main class="editor-wrap">
    <h1>Universe Editor</h1>
    <p class="muted">Create and publish research entries into the Universe feed. Admin access only.</p>

    <div id="editorLocked" class="note-box" role="alert">
      <strong>Access restricted.</strong>
      <span id="editorLockMsg"> Admin sign-in required to use this page.</span>
      <button class="btn small" data-open-auth="signin">Sign in</button>
    </div>

    <form id="analysisForm" class="editor-grid" hidden>
      <section class="analysis-source">
        <div class="analysis-source__head">
          <label for="analysisRaw" style="margin:0;font-weight:600">Analysis input</label>
          <div class="analysis-source__modes" role="tablist">
            <button type="button" class="analysis-mode-btn active" data-analysis-mode="manual">Paste analysis</button>
            <button type="button" class="analysis-mode-btn" data-analysis-mode="ai">Generate via AI</button>
          </div>
        </div>
        <div class="analysis-source__panel" data-panel="manual">
          <p class="analysis-source__panel-note">Paste the full master analysis markdown below, then parse it to fill the fields automatically.</p>
        </div>
        <div class="analysis-source__panel analysis-ai-grid" data-panel="ai" hidden>
          <div class="field-row">
            <div>
              <label for="aiCompany">Company</label>
              <input id="aiCompany" placeholder="Insmed Incorporated" autocomplete="off" />
              <p class="muted-small">Only the company name is required to run a prompt.</p>
            </div>
            <div>
              <label for="aiTicker">Ticker (optional)</label>
              <input id="aiTicker" placeholder="INSM" autocomplete="off" />
            </div>
            <div>
              <label for="aiExchange">Exchange (optional)</label>
              <input id="aiExchange" placeholder="NASDAQ" autocomplete="off" />
            </div>
          </div>
          <div>
            <label>Prompt template</label>
            <div class="prompt-selector">
              <button type="button" class="btn ghost" id="promptSelectBtn"><span id="promptSelectLabel">Select prompt</span> â–¾</button>
              <button type="button" class="btn small ghost" id="openPromptEditor">Prompt editor</button>
              <div class="prompt-menu" id="promptMenu" hidden role="menu"></div>
            </div>
            <p class="muted-small" id="promptSummary">Loading promptsâ€¦</p>
            <pre id="promptPreview" class="prompt-preview" hidden></pre>
          </div>
          <div class="field-row">
            <div>
              <label for="aiModel">Model</label>
              <div class="select-edit">
                <select id="aiModel"></select>
                <button type="button" class="btn small ghost" id="editModelList">Edit list</button>
              </div>
              <p class="muted-small">Select from saved OpenRouter models or edit the list for this workspace.</p>
              <div class="model-editor" id="modelEditor" hidden>
                <label for="modelEditorInput" style="font-weight:600">Update model options</label>
                <textarea id="modelEditorInput" placeholder="openrouter/auto | OpenRouter Auto"></textarea>
                <p class="muted-small">One model per line. Use <code>model-id | Friendly label</code>. First model becomes the default.</p>
                <div class="model-editor__actions">
                  <button type="button" class="btn small primary" id="saveModelList">Save list</button>
                  <button type="button" class="btn small ghost" id="cancelModelList">Cancel</button>
                  <span class="muted-small" id="modelEditorStatus"></span>
                </div>
              </div>
            </div>
            <div>
              <label for="aiKey">AI API key</label>
              <input id="aiKey" type="password" placeholder="Paste your OpenRouter key" autocomplete="off" />
              <p class="muted-small">Stored locally in this browser.</p>
            </div>
          </div>
          <div>
            <label for="aiNotes">Angle or extra guidance (optional)</label>
            <textarea id="aiNotes" placeholder="Key catalysts, data points or tone adjustments"></textarea>
          </div>
          <div class="analysis-source__actions">
            <button type="button" class="btn primary" id="generateAnalysis">Generate analysis</button>
            <span class="muted-small">The generated report fills the box below.</span>
          </div>
        </div>
        <textarea id="analysisRaw" name="analysis_raw" placeholder="Paste the MASTER STOCK ANALYSIS markdown output here"></textarea>
        <div class="analysis-source__actions">
          <button type="button" class="btn" id="parseAnalysis">Parse analysis into fields</button>
          <button type="button" class="btn ghost" id="clearAnalysis">Clear</button>
          <span id="analysisStatus" class="analysis-status muted-small" role="status"></span>
        </div>
      </section>

      <div class="field-row">
        <div>
          <label for="analysisDate">Date</label>
          <input id="analysisDate" name="date" type="date" required />
        </div>
        <div>
          <label for="analysisTags">Tags (comma separated)</label>
          <input id="analysisTags" name="tags" placeholder="AI, Earnings, Value" />
          <p class="muted-small">Used for filtering. Example: AI, Earnings, Value.</p>
        </div>
      </div>

      <div>
        <label for="analysisTopic">Topic</label>
        <input id="analysisTopic" name="topic" placeholder="Reverse DCF â€” Company" required />
      </div>

      <div>
        <label for="analysisConclusion">Conclusion</label>
        <textarea id="analysisConclusion" name="conclusion" placeholder="Summarize the key takeaway." required></textarea>
      </div>

      <div>
        <label for="analysisFindings">Key findings (one per line)</label>
        <textarea id="analysisFindings" name="findings" placeholder="Finding #1\nFinding #2"></textarea>
      </div>

      <div>
        <label for="analysisVisual">Visual/Table markdown</label>
        <textarea id="analysisVisual" name="visual" placeholder="|Scenario|Rev CAGR|..."></textarea>
      </div>

      <div>
        <label for="analysisPrompt">Prompt used (optional, debug)</label>
        <textarea id="analysisPrompt" name="prompt" placeholder="Paste the LLM prompt for auditing"></textarea>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
        <button class="btn primary" type="submit">Publish to Universe</button>
        <button class="btn" type="button" id="resetForm">Reset</button>
        <span id="formMsg" class="muted"></span>
      </div>
    </form>

    <section id="recentSection" hidden>
      <header style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin:28px 0 12px">
        <h2 style="margin:0">Recent entries</h2>
        <button class="btn small" type="button" id="refreshRecent">Refresh</button>
      </header>
      <div id="recentList" class="recent-list"></div>
    </section>
  </main>

  <div id="promptEditorModal" class="modal" hidden role="dialog" aria-modal="true" aria-labelledby="promptEditorTitle">
    <div class="modal__backdrop" data-close-prompt></div>
    <div class="modal__dialog">
      <header class="modal__header">
        <h2 id="promptEditorTitle" style="margin:0;font-size:1.15rem">Prompt library</h2>
        <button type="button" class="btn small ghost" id="closePromptEditor">Close</button>
      </header>
      <div class="modal__body">
        <aside class="modal__sidebar">
          <div class="prompt-editor__sidebar-actions">
            <strong style="font-size:.95rem">Saved prompts</strong>
            <button type="button" class="btn small ghost" id="addPromptTemplate">New</button>
          </div>
          <div id="promptEditorList" class="prompt-editor__list"></div>
        </aside>
        <div class="modal__content">
          <form id="promptEditorForm" class="prompt-editor__form">
            <input type="hidden" id="promptEditorId" />
            <div class="prompt-editor__row">
              <div class="field-group">
                <label for="promptEditorName">Name</label>
                <input id="promptEditorName" name="name" placeholder="Deep research" required />
              </div>
              <div class="field-group">
                <label for="promptEditorSlug">Slug (optional)</label>
                <input id="promptEditorSlug" name="slug" placeholder="deep-research" />
              </div>
              <div class="field-group">
                <label for="promptEditorSortOrder">Sort order</label>
                <input id="promptEditorSortOrder" name="sort_order" type="number" min="0" step="1" placeholder="100" />
              </div>
            </div>
            <div class="field-group">
              <label for="promptEditorDescription">Summary</label>
              <textarea id="promptEditorDescription" name="description" placeholder="Short summary for the selector"></textarea>
            </div>
            <div class="field-group">
              <label for="promptEditorText">Prompt template</label>
              <textarea id="promptEditorText" name="prompt_text" placeholder="Write the AI template here" required></textarea>
              <p class="muted-small">Use template tags like <code>{{company}}</code>, <code>{{ticker}}</code> or <code>{{notes_block}}</code> as needed.</p>
            </div>
            <div class="prompt-editor__toggles">
              <label class="prompt-editor__toggle"><input type="checkbox" id="promptEditorDefault" name="is_default" /> Default prompt</label>
              <label class="prompt-editor__toggle"><input type="checkbox" id="promptEditorArchived" name="archived" /> Archived</label>
            </div>
            <p id="promptEditorStatus" class="muted-small prompt-editor__status"></p>
          </form>
        </div>
      </div>
      <footer class="modal__footer">
        <button type="button" class="btn ghost" id="cancelPromptEditor">Cancel</button>
        <button type="submit" class="btn primary" form="promptEditorForm" id="savePromptEditor">Save prompt</button>
      </footer>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-col footer-about">
        <a class="brand" href="/">
          <img src="/images/logo.webp" alt="FutureFunds.ai logo" class="logo" />
          <span>FutureFunds.ai</span>
        </a>
        <p class="muted">Researching how AI can run the investment process in public. Educational only.</p>
      </div>
      <div class="footer-col footer-links">
        <h3 class="footer-heading">Explore</h3>
        <ul class="footer-links-list">
          <li><a href="/strategy.html">Strategy</a></li>
          <li><a href="/tools.html">Investment Tools</a></li>
          <li><a href="/portfolio.html">Portfolios</a></li>
          <li><a href="/blog.html">Commentary</a></li>
        </ul>
      </div>
      <div class="footer-col footer-links">
        <h3 class="footer-heading">Legal &amp; Access</h3>
        <ul class="footer-links-list">
          <li><a href="/disclaimer.html">Disclaimer &amp; Disclosures</a></li>
          <li><a href="/membership.html">Membership</a></li>
          <li><a href="/login.html">Member Login</a></li>
          <li><a href="/editor.html">Editor (admin)</a></li>
        </ul>
      </div>
      <div class="footer-col footer-newsletter">
        <h3 class="footer-heading">Stay in the loop</h3>
        <p class="muted">Sign up for updates on new research drops and product releases.</p>
        <form class="newsletter-form" novalidate>
          <label class="sr-only" for="newsletter-email">Email address</label>
          <input id="newsletter-email" type="email" name="email" placeholder="you@example.com" autocomplete="email" required />
          <button type="submit" class="btn primary">Join the list</button>
        </form>
        <p class="newsletter-status muted" aria-live="polite"></p>
      </div>
    </div>
    <div class="footer-bottom">
      <small>Â© <span id="year"></span> FutureFunds.ai. Educational experiment. Not investment advice.</small>
      <div class="footer-legal">
        <a href="/disclaimer.html">Disclaimer</a>
        <a href="/sitemap.xml">Sitemap</a>
        <a href="/editor.html">Editor</a>
      </div>
    </div>
  </footer>


  <script src="/assets/app.js" defer></script>
  <script src="/assets/i18n.js" defer></script>
  <script src="/assets/paywall.js" defer></script>
  <script type="module" src="/assets/auth.js"></script>
  <script type="module" src="/assets/editor.js"></script>
</body>
</html>
